tinymce.PluginManager.add("wppaphoto",function(o,p){o.addButton("wppa_photo_button",{image:wppaImageDirectory+"camera32.png",tooltip:"WPPA+ Insert photo",onclick:function(){var o={modal:!0,resizable:!0,width:720,show:{effect:"fadeIn",duration:400},closeText:"",close:function(o,p){wppaMyPhotoSelection||(wppaMyPhotoSelection=!0,jQuery("#wppaphoto-allphoto-tr").hide(),jQuery("#wppaphoto-myphoto-tr").show(),jQuery("#wppaphoto-photo-preview").html(""),jQuery(".wppa-photo-select-item").prop("selected",!1),jQuery(".wppa-photo-select-item-first").prop("selected",!0))},open:function(o,p){wppaPhotoEvaluate()}};jQuery("#wppaphoto-form").dialog(o).dialog("open"),jQuery(".ui-widget-header").css({background:"none"}),jQuery(".ui-dialog").css({boxShadow:"0px 0px 5px 5px #aaaaaa",borderRadius:wppaBoxRadius+"px",padding:"8px",backgroundColor:wppaModalBgColor,boxSizing:"content-box",zIndex:200200}),jQuery(".ui-dialog-titlebar").css({lineHeight:"0px",height:"24px",fontSize:"18px",fontWeight:"bold"}),jQuery(".ui-dialog-title").css({position:"absolute",top:"15px",fontSize:"18px",fontWeight:"bold"}),jQuery(".ui-button").css({backgroundImage:wppaModalQuitImg,padding:0,position:"absolute",right:"8px",top:"20px",width:"16px",height:"16px"}),jQuery(".ui-widget-overlay").css({background:"none"}),jQuery(".ui-button").attr("title","Close"),jQuery(".ui-icon-closethick").css({display:"none"})}})}),jQuery(function(){var p=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),o=wppaAjaxUrl+"?action=wppa&wppa-action=tinymcephotodialog";p.open("GET",o,!0),p.send(),p.onreadystatechange=function(){var o;4==p.readyState&&404!=p.status&&(o=wppaEntityDecode(p.responseText),(o=jQuery(o)).find("table"),o.appendTo("body").hide(),o.find("#wppaphoto-submit").click(function(){newShortcode=jQuery("#wppaphoto-shortcode-preview").val(),newShortcode=newShortcode.replace(/&quot;/g,'"'),tinyMCE.activeEditor.execCommand("mceInsertContent",0,newShortcode),wppaMyPhotoSelection=!0,jQuery("#wppaphoto-allphoto-tr").hide(),jQuery("#wppaphoto-myphoto-tr").show(),jQuery("#wppaphoto-photo-preview").html(""),jQuery("#wppaphoto-form").dialog("close")}))}});var wppaMyPhotoSelection=!0;function wppaPhotoEvaluate(){var o=wppaMyPhotoSelection?"my":"all";photo=jQuery("#wppaphoto-"+o+"photo").val(),o=wppaIsEmpty(photo)?(jQuery("#wppaphoto-"+o+"photo").css("color","#700"),""):(id=photo.replace(/\//g,""),id=id.split("."),id=id[0],jQuery("#wppaphoto-photo-preview-tr").show(),wppaTinyMceBasicPhotoPreview(photo),jQuery("#wppaphoto-"+o+"photo").css("color","#070"),"[photo "+id),jQuery("#wppaphoto-cache").prop("checked")&&(o+=' cache="inf"'),o.length&&(o+="]");o='<input type="text" id="wppaphoto-shortcode-preview" style="background-color:#ddd; width:100%; height:26px;" value="'+(o=o.replace(/"/g,"&quot;"))+'" />';jQuery("#wppaphoto-shortcode-preview-container").html(o),!wppaIsEmpty(photo)?(jQuery("#wppaphoto-submit").show(),jQuery("#wppaphoto-submit-notok").hide()):(jQuery("#wppaphoto-submit").hide(),jQuery("#wppaphoto-submit-notok").show())}function wppaTinyMceBasicPhotoPreview(o){var p;"#potd"==o?jQuery("#wppaphoto-photo-preview").html(wppaNoPreview):-1!=o.indexOf("xxx")?(p=o.replace("xxx",""),jQuery("#wppaphoto-photo-preview").html('<video preload="metadata" style="max-width:400px; max-height:300px; margin-top:3px;" controls><source src="'+wppaPhotoDirectory+p+'mp4" type="video/mp4"><source src="'+wppaPhotoDirectory+p+'ogg" type="video/ogg"><source src="'+wppaPhotoDirectory+p+'ogv" type="video/ogg"><source src="'+wppaPhotoDirectory+p+'webm" type="video/webm"></video>')):jQuery("#wppaphoto-photo-preview").html('<img src="'+wppaPhotoDirectory+o+'" style="max-width:400px; max-height:300px;" />')}function wppaDisplaySelectedFile(o,p){o=jQuery("#"+o)[0].files[0].name;jQuery("#"+p).val("Upload "+o)}