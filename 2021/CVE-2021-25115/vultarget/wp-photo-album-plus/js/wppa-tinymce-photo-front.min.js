tinymce.PluginManager.add("wppaphoto",function(o,e){o.addButton("wppa_photo_button",{image:wppaImageDirectory+"camera32.png",tooltip:"WPPA+ Insert photo",onclick:function(){var o={modal:!0,resizable:!0,width:720,show:{effect:"fadeIn",duration:400},closeText:"",close:function(o,e){wppaMyPhotoSelection||(wppaMyPhotoSelection=!0,jQuery("#wppaphoto-allphoto-tr").hide(),jQuery("#wppaphoto-myphoto-tr").show(),jQuery("#wppaphoto-photo-preview").html(""),jQuery(".wppa-photo-select-item").prop("selected",!1),jQuery(".wppa-photo-select-item-first").prop("selected",!0))},open:function(o,e){wppaPhotoEvaluate()}};jQuery("#wppaphoto-form").dialog(o).dialog("open"),jQuery(".ui-widget-header").css({background:"none"}),jQuery(".ui-dialog").css({boxShadow:"0px 0px 5px 5px #aaaaaa",borderRadius:wppaBoxRadius+"px",padding:"8px",backgroundColor:wppaModalBgColor,boxSizing:"content-box",zIndex:200200}),jQuery(".ui-dialog-titlebar").css({lineHeight:"0px",height:"24px"}),jQuery(".ui-dialog-title").css({position:"absolute",top:"15px"}),jQuery(".ui-button").css({backgroundImage:wppaModalQuitImg,padding:0,position:"absolute",right:"8px",top:"20px",width:"16px",height:"16px"}),jQuery(".ui-widget-overlay").css({background:"none"}),jQuery(".ui-button").attr("title","Close"),jQuery(".ui-icon-closethick").css({display:"none"})}})}),jQuery(function(){var e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),o=wppaAjaxUrl+"?action=wppa&wppa-action=tinymcephotodialogfront";e.onreadystatechange=function(){var o;4==e.readyState&&404!=e.status&&(o=wppaEntityDecode(e.responseText),(o=jQuery(o)).find("table"),o.appendTo("body").hide(),o.find("#wppaphoto-submit").click(function(){newShortcode=jQuery("#wppaphoto-shortcode-preview").val(),newShortcode=newShortcode.replace(/&quot;/g,'"'),tinyMCE.activeEditor.execCommand("mceInsertContent",0,newShortcode),wppaMyPhotoSelection||(wppaMyPhotoSelection=!0,jQuery("#wppaphoto-allphoto-tr").hide(),jQuery("#wppaphoto-myphoto-tr").show(),jQuery("#wppaphoto-photo-preview").html(""),jQuery(".wppa-photo-select-item").prop("selected",!1),jQuery(".wppa-photo-select-item-first").prop("selected",!0),jQuery("#wppaphoto-myphoto").val("")),jQuery("#wppaphoto-form").dialog("close")}))},e.open("GET",o,!0),e.send()});var wppaMyPhotoSelection=!0;function wppaPhotoEvaluate(){var o,e,p=wppaMyPhotoSelection?"my":"all";if(photo=jQuery("#wppaphoto-"+p+"photo").val(),wppaIsEmpty(photo))jQuery("#wppaphoto-"+p+"photo").css("color","#700"),o="";else{switch(wppaOutputType){case"shortcode":id=photo.replace(/\//g,""),id=id.split("."),id=id[0],o="[photo "+id+"]";break;case"html":o=-1!=photo.indexOf("xxx")?"Videos are not supported here":(e=wppaShortcodeTemplateId,wppaShortcodeTemplate.split(e).join(photo));break;case"img":o=-1!=photo.indexOf("xxx")?(e=photo.replace("xxx",""),'<video preload="metadata" style="width:100%;height:auto;" controls ><source src="'+wppaPhotoDirectory+e+'mp4" type="video/mp4"><source src="'+wppaPhotoDirectory+e+'ogg" type="video/ogg"><source src="'+wppaPhotoDirectory+e+'ogv" type="video/ogg"><source src="'+wppaPhotoDirectory+e+'webm" type="video/webm"></video>'):'<img src="'+wppaPhotoDirectory+photo+'" />';break;default:o="Unimplemented output type"}jQuery("#wppaphoto-"+p+"photo").css("color","#070"),o=o.replace(/"/g,"&quot;"),jQuery("#wppaphoto-photo-preview-tr").show(),wppaTinyMceBasicPhotoPreview(photo)}p='<input type="text" id="wppaphoto-shortcode-preview" style="background-color:#ddd; width:100%; height:26px;" value="'+o+'" />';jQuery("#wppaphoto-shortcode-preview-container").html(p),!wppaIsEmpty(photo)?(jQuery("#wppaphoto-submit").show(),jQuery("#wppaphoto-submit-notok").hide()):(jQuery("#wppaphoto-submit").hide(),jQuery("#wppaphoto-submit-notok").show())}function wppaTinyMceBasicPhotoPreview(o){var e;jQuery("#wppaphoto-photo-preview").html(""),"#potd"==o?jQuery("#wppaphoto-photo-preview").html(wppaNoPreview):-1!=o.indexOf("xxx")?(e=o.replace("xxx",""),jQuery("#wppaphoto-photo-preview").html('<video preload="metadata" style="max-width:400px; max-height:300px; margin-top:3px;" controls><source src="'+wppaPhotoDirectory+e+'mp4" type="video/mp4"><source src="'+wppaPhotoDirectory+e+'ogg" type="video/ogg"><source src="'+wppaPhotoDirectory+e+'ogv" type="video/ogg"><source src="'+wppaPhotoDirectory+e+'webm" type="video/webm"></video>')):jQuery("#wppaphoto-photo-preview").html('<img src="'+wppaPhotoDirectory+o+'" style="max-width:400px; max-height:300px;" />')}function wppaDisplaySelectedFile(o,e){o=jQuery("#"+o)[0].files[0].name;jQuery("#"+e).val("Upload "+o)}